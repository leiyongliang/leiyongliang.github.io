var Puzzle=function(t){this._init(t)};Puzzle.prototype={_init:function(t){this.leverNow=t.leverNow<=2?2:t.leverNow||2,this.leverArr=[this.leverNow,this.leverNow],this.imgOrigArr=[],this.imgRandomArr=[],this.stepnum=0,this.btnObj=document.getElementById("btn"),this.main=document.getElementById("main"),this.inputObj=document.getElementById("file"),this.time=document.getElementById("time"),this.timer=null,this.step=document.getElementById("step"),this.imgArea=document.getElementById("imgArea"),this.gameStartBtnObj=document.getElementById("gameStart"),this.gameAreaObj=document.getElementById("gameArea"),this.imgCells="",this.imgAreaWidth=t.imgAreaSize<=400?400:t.imgAreaSize||400,this.imgAreaHeight=t.imgAreaSize<=400?400:t.imgAreaSize||400,this.gameAreaObj.style.width=this.imgAreaWidth+"px",this.gameAreaObj.style.height=this.imgAreaHeight+this.gameStartBtnObj.offsetHeight+30+"px",this.cellWidth=this.imgAreaWidth/this.leverArr[1],this.cellHeight=this.imgAreaHeight/this.leverArr[0],this.hasStart=0,this.sel=null,this.imgUrl=""},gameStart:function(){this.getImageUrl()},getImageUrl:function(){var t=this;this.btnObj.onclick=function(){t.inputObj.click()},this.inputObj.onchange=function(){var e=this.files,i=new FileReader;i.readAsDataURL(e[0]),i.onload=function(){t.imgUrl=i.result,t.imgSplit()}}},imgSplit:function(){this.imgArea.innerHTML="";for(var t="",e=0,i=this.leverArr[0];e<i;e++)for(var r=0,i=this.leverArr[1];r<i;r++)this.imgOrigArr.push(e*this.leverArr[0]+r),t=document.createElement("div"),t.className="imgCell",t.index=e*this.leverArr[0]+r,t.style.width=this.cellWidth+"px",t.style.height=this.cellHeight+"px",t.style.left=r*this.cellWidth+"px",t.style.top=e*this.cellHeight+"px",t.style.backgroundImage="url("+this.imgUrl+")",t.style.backgroundSize=this.leverArr[1]+"00%",t.style.backgroundPosition=-r*this.cellWidth+"px "+-e*this.cellHeight+"px",t.style.backgroundOrigin="border-box",this.imgArea.appendChild(t);this.imgCells=document.querySelectorAll(".imgCell"),this.main.style.left=-this.main.offsetWidth+"px",this.gameAreaObj.style.left="50%",this.gameAreaObj.style.transform="translateX(-50%)",document.body.style.overflowY="auto",this.gameStartBtnObj.onclick=this.clickHandle()},clickHandle:function(){var t=this;return function(){if(0==t.hasStart){clearInterval(t.timer),t.stepnum=0,t.step.innerHTML=0,t.timeStart(),t.hasStart=1,t.randomArr(),t.cellOrder();for(var e=0,i=t.imgCells.length;e<i;e++)t.imgCells[e].onclick=function(){if(null===t.sel)t.sel=this.index,this.style.border="2px solid red";else{if(t.imgCells.forEach(function(t){t.style.border="1px solid #fff"}),this.index===t.sel)return void(t.sel=null);t.cellExchange(t.sel,this.index),t.sel=null}}}}},timeStart:function(){var t=this,e=(new Date).getTime();this.timer=setInterval(function(){var i=(new Date).getTime()-e,r=(Math.floor(i/864e5),i%864e5),l=(Math.floor(r/36e5),r%36e5),s=Math.floor(l/6e4),h=l%6e4,n=Math.round(h/1e3);s?t.time.innerHTML=s+"分 "+n+"秒":t.time.innerHTML=n+"秒"},1e3)},randomArr:function(){this.imgRandomArr=[];for(var t=!0,e=0,i=this.imgOrigArr.length;e<i;e++){var r=Math.floor(Math.random()*this.imgOrigArr.length);if(this.imgRandomArr.length>0)for(;this.imgRandomArr.indexOf(r)>-1;)r=Math.floor(Math.random()*this.imgOrigArr.length);this.imgRandomArr.push(r)}if(this.imgRandomArr.length===this.imgOrigArr.length)for(var e=0,i=this.imgOrigArr.length;e<i;e++){if(this.imgRandomArr[e]!=this.imgOrigArr[e]){t=!1;break}t=!0}else t=!0;t&&this.randomArr()},cellOrder:function(){var t=this;this.imgCells.forEach(function(e,i){e.style.left=t.imgRandomArr[i]%t.leverArr[1]*t.cellWidth+"px",e.style.top=Math.floor(t.imgRandomArr[i]/t.leverArr[1])*t.cellHeight+"px"})},cellExchange:function(t,e){var i=Math.floor(this.imgRandomArr[t]/this.leverArr[1]),r=this.imgRandomArr[t]%this.leverArr[1],l=Math.floor(this.imgRandomArr[e]/this.leverArr[1]),s=this.imgRandomArr[e]%this.leverArr[1];this.imgCells[t].style.left=s*this.cellWidth+"px",this.imgCells[t].style.top=l*this.cellHeight+"px",this.imgCells[e].style.left=r*this.cellWidth+"px",this.imgCells[e].style.top=i*this.cellHeight+"px";var h=this.imgRandomArr[t];this.imgRandomArr[t]=this.imgRandomArr[e],this.imgRandomArr[e]=h,this.stepnum+=1,this.step.innerHTML=this.stepnum,this.imgOrigArr.toString()===this.imgRandomArr.toString()&&this.success()},success:function(){clearInterval(this.timer),this.hasStart=0,setTimeout(function(){alert("恭喜完成游戏")},600)}};